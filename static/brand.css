:root, :host { color-scheme: light dark; }
*{ box-sizing:border-box }
html, body{ height:100% }

/* Fluid type – keeps headings legible without crowding cards */
:root{ 
  --step-0: clamp(.95rem, .85rem + .4vw, 1.05rem);
  --step-1: clamp(1.05rem, .9rem + .7vw, 1.35rem);
  --step-2: clamp(1.25rem, 1rem + 1.2vw, 1.8rem);
  --rf-scale: md;
  --rf-font-size: 16px;
}

:root[data-scale="sm"]{ --rf-font-size: 14px; }
:root[data-scale="md"]{ --rf-font-size: 16px; }
:root[data-scale="lg"]{ --rf-font-size: 18px; }
:root[data-scale="xl"]{ --rf-font-size: 20px; }

html{ font-size: var(--rf-font-size, 16px) }

body{ margin:0; font: 400 1rem/1.55 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif }

.rf-page{ --content-max: 1280px; width:min(100%, var(--content-max)); margin:0 auto; padding:16px; }

:root{
  /* Spacing tokens */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 12px;
  --space-lg: 16px;
  --space-xl: 24px;
  --space-2xl: 32px;
  
  /* Radius tokens */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 14px;
  --radius-full: 999px;
  
  /* Colors */
  --bg-0:#eef1f8; --bg-1:#ffffff; --bg-2:#e3e7f5;
  --text:#0f172a; --muted:#475569; --border:#c8d2f0; --shadow-rgb:15 23 42;
  --brand-red:#c61e1f; --brand-red-ink:#a01516; --brand-graphite:#475569;
  --brand-navy:#1e3a8a; --brand-sky:#2563eb;
  --link:#1d4ed8; --link-visited:#6e3ee6; --focus:#00c2ff;
  --ok:#0f9d58; --warn:#f59e0b; --danger:#dc2626; --info:#2563eb;
  --accent: var(--brand-red);
  
  /* Calendar tokens (Light + Dark + HC) */
  --cal-bg: var(--bg-0);
  --cal-day: var(--bg-0);
  --cal-day-border: var(--border);
  --cal-num: color-mix(in oklab, var(--text) 92%, black);     /* higher contrast numerals */
  --cal-muted: color-mix(in oklab, var(--text) 60%, transparent);
  --cal-focus: color-mix(in oklab, var(--accent) 60%, black); /* focus ≥3:1 */
}

:root[data-theme="LightVim"]{
  --bg-0:#eef1f8; --bg-1:#ffffff; --bg-2:#e3e7f5;
  --text:#0f172a; --muted:#475569; --border:#c8d2f0; --shadow-rgb:15 23 42;
  --accent-1: var(--brand-red-ink); --accent-2:#1e3a8a; --chip: var(--brand-graphite);
}
:root[data-theme="DarkVim"]{
  --bg-0:#0f172a; --bg-1:#131c2f; --bg-2:#1c2942;
  --text:#f8fafc; --muted:#cbd5f5; --border:#314165; --shadow-rgb:2 6 23;
  --accent-1:#ff6d6e; --accent-2:#8fb4ff; --chip:#dbe5ff;
}
:root[data-theme="HighContrastVim"]{
  --bg-0:#000; --bg-1:#090909; --bg-2:#151515; --text:#fff; --muted:#f5f5f5; --border:#fff; --shadow-rgb:0 0 0;
  --accent-1:#ff3b3c; --accent-2:#f0dfc8; --chip:#fff;
}

/* Calendar-specific styling for Light mode */
.cal .day-num { color: var(--cal-num); }
.cal .day:focus-visible { outline: 3px solid var(--cal-focus); outline-offset: 2px; }

body{ background:var(--bg-0); color:var(--text) }
a{ color:var(--link); text-decoration:underline; text-underline-offset:2px }
a:visited{ color:var(--link-visited) }
:focus-visible{ outline:2px solid var(--focus); outline-offset:2px; border-radius:var(--radius-sm) }

/* Improved card styling */
.card, .rf-panel{ 
  background:var(--bg-1); 
  border:1px solid color-mix(in oklab,var(--border) 85%, transparent); 
  border-radius:var(--radius-lg); 
  box-shadow:0 16px 32px rgba(var(--shadow-rgb)/.12); 
}
.card{ padding:var(--space-lg); container-type: inline-size; container-name: card; }

/* Improved tag/button styling */
.tag{ 
  display:inline-flex; 
  align-items:center; 
  gap:var(--space-sm); 
  padding:var(--space-sm) var(--space-md); 
  border-radius:var(--radius-full); 
  border:1px solid color-mix(in oklab,var(--border) 90%, transparent); 
  background:color-mix(in oklab,var(--bg-1) 55%, var(--bg-2) 45%); 
  color:var(--text); 
  text-decoration:none; 
  white-space:nowrap; 
  cursor:pointer;
  transition:background .2s ease, border-color .2s ease, color .2s ease, transform .2s ease 
}
.tag:hover{ 
  background:color-mix(in oklab,var(--bg-2) 70%, var(--bg-1) 30%); 
  transform:translateY(-1px);
}
.tag.is-active{ 
  background:linear-gradient(135deg,var(--accent-1),color-mix(in oklab,var(--accent-1) 70%, var(--accent-2))); 
  color:#fff; 
  border-color:color-mix(in oklab,var(--accent-1) 60%, transparent) 
}

.rf-btn, button:not(.tag){ 
  background:linear-gradient(135deg,var(--accent-1),color-mix(in oklab,var(--accent-1) 70%, var(--accent-2))); 
  color:#fff; 
  border:none; 
  padding:10px 14px; 
  border-radius:var(--radius-md); 
  font-weight:600; 
  cursor:pointer;
  box-shadow:0 10px 24px rgba(var(--shadow-rgb)/.18); 
  transition:transform .15s ease, box-shadow .15s ease 
}
.rf-btn:hover, button:not(.tag):hover{ 
  transform:translateY(-1px); 
  box-shadow:0 14px 34px rgba(var(--shadow-rgb)/.22) 
}
.rf-btn.ghost, .tag.ghost{ background:transparent; color:var(--text) }

.tag--meta{ 
  font-size:.7rem; 
  text-transform:uppercase; 
  letter-spacing:.04em; 
  background:color-mix(in oklab,var(--bg-2) 60%, transparent); 
  border:1px solid color-mix(in oklab,var(--border) 80%, transparent); 
}
.tag--status{ 
  display:inline-flex; 
  align-items:center; 
  gap:var(--space-xs); 
  font-size:.75rem; 
  font-weight:600; 
}

/* Improved input styling */
.rf-input, select.rf-input, textarea.rf-input{ 
  width:100%; 
  color:var(--text); 
  background:var(--bg-0); 
  border:1px solid color-mix(in oklab,var(--border) 85%, transparent); 
  border-radius:var(--radius-md); 
  padding:10px var(--space-md); 
  transition:border-color .2s ease, box-shadow .2s ease 
}
.rf-input:focus{ 
  border-color:color-mix(in oklab,var(--accent-1) 70%, transparent); 
  box-shadow:0 0 0 4px color-mix(in oklab,var(--accent-1) 20%, transparent) 
}

/* Table styling */
.rf-table{ width:100%; border-collapse:collapse }
.rf-table thead th{ 
  text-align:left; 
  border-bottom:2px solid var(--border); 
  padding:var(--space-sm) 10px; 
  background:var(--bg-2);
  font-weight:600;
}
.rf-table tbody td{ 
  padding:var(--space-sm) 10px; 
  border-bottom:1px solid var(--border) 
}

/* Layout helpers */
.grid{ display:grid; gap:10px }
.row{ display:flex; gap:10px; align-items:center }
.muted{ color:var(--muted) }
.rf-right{ display:grid; gap:var(--space-lg); min-height:0 } 
.rf-right>*{ min-height:0 } 
.rf-scroll{ overflow:auto; min-height:0 }

.fade-in{ animation:fade-in .18s ease-out both }

@keyframes fade-in{ from{ opacity:0; transform:translateY(6px) } to{ opacity:1; transform:none } }

@media (prefers-reduced-motion: reduce){ *{ animation:none !important; transition:none !important } }
@media (forced-colors: active){ :root{ --border: CanvasText } .card,.rf-panel,.rf-input{ border:1px solid CanvasText } }

/* Container queries - scale inner UI based on card width */
@container card (width <= 420px){
  .card{ padding:12px }
  .rf-table td, .rf-table th{ padding:6px }
  h2, .card h2{ font-size: var(--step-1) }
}
@container card (width > 900px){
  h2, .card h2{ font-size: var(--step-2) }
}

/* Mobile tokens: fluid type, tap targets, container queries */
:root{
  --t-0: clamp(.94rem, .86rem + .35vw, 1.05rem);
  --t-1: clamp(1.06rem, .9rem + .7vw, 1.32rem);
  --tap-min: 44px;       /* comfortable; WCAG min is 24×24 CSS px */
  --rail-safe: env(safe-area-inset-bottom, 0px);
}
.rf-page{ width:min(100%, 1180px); margin:0 auto; padding:12px; }

/* Universal tap target + focus ring */
button, .tag, .icon { min-height: var(--tap-min); min-width: var(--tap-min); }
:where(button,.icon,.tag):focus-visible{ outline:3px solid var(--focus); outline-offset:2px; }

/* Cards become query containers so internals scale to card width */
.card{ container-type:inline-size; container-name:card; }
@container card (width <= 480px){
  .card{ padding:12px }
  .rf-table th,.rf-table td{ padding:6px }
  h2{ font-size: var(--t-1); }
}

/* Compact header + Bottom Nav (mobile) */
@media (max-width: 820px){
  .rf-topbar .main{ display:none; }
  .rf-bottomnav{ display:flex; }
}
